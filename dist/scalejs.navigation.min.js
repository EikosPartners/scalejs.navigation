define("scalejs.navigation",["scalejs!core","knockout","crossroads","hasher","lodash"],function(a,b,c,d,e){"use strict";function f(a){for(var b={},c=a.substr(1).split("&"),d=0;d<c.length;d+=1){var e=c[d].split("=");b[decodeURIComponent(e[0])]=decodeURIComponent(e[1]||"");try{b[decodeURIComponent(e[0])]=JSON.parse(b[decodeURIComponent(e[0])])}catch(f){}}return Object.keys(b).forEach(function(a){"true"===b[a]?b[a]=!0:"false"===b[a]?b[a]=!1:"string"==typeof b[a]&&-1!==b[a].indexOf(",")&&(b[a]=b[a].split(","))}),b}function g(a,b){var d,e,g,h,i,j=a.text,k=[];return a.route?(d=a.route,e=d.split("/")[0],g=function(){c.parse(e)},i=function(a){if("string"==typeof a){var c=a.split("?");a=c.length>1?{route:e,path:c[0],query:f("?"+c[1])}:{route:e,path:c[0]||""}}else a=a?{route:e,path:"",query:a}:{route:e,path:""};"/"===a.path[a.path.length-1]&&(a.path=a.path.slice(0,a.path.length-1)),a.url=a.route+(a.path?"/"+a.path:"")+(a.query?"/?"+l(a.query):""),v=a,w(v),u&&(b(a),r(h))},k.push(c.addRoute(d,i)),d!==e&&k.push(c.addRoute(e,i))):g=b,h=p(a,{navText:j,navigate:function(){r(h),g()},routes:k,canNav:a.canNav||function(){return!0}}),q.push(h),s[j]=h,h}function h(a){s[a]&&(q.remove(s[a]),s[a].routes.forEach(function(a){c.removeRoute(a)}),delete s[a])}function i(a){r()!==s[a]&&r(s[a])}function j(){0===q().length||r()||q()[0].navigate()}function k(a,b){c.parse(a)}function l(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent("string"==typeof a[c]?a[c]:JSON.stringify(a[c])));return b.join("&")}function m(a,b,c,e){var f=v.route+(v.path?"/"+v.path:"");return f===a&&JSON.stringify(v.query||{})===JSON.stringify(b)?void console.warn("Trying to set the same route; will be disregarded"):(c===!1&&(u=!1),b&&(a+="/?"+l(b)),e===!1?d.replaceHash(a):d.setHash(a),void(u=!0))}function n(){var a=v.url;c.resetState(),c.parse(a)}function o(){return e.cloneDeep(w())}var p=a.object.merge,q=b.observableArray(),r=b.observable(),s={},t=t,u=!0,v={},w=b.observable(v);return t={navLinks:q,activeLink:r,navigate:i,addNav:g,removeNav:h,init:j,setRoute:m,getCurrent:o,reRoute:n,serialize:l},a.registerExtension({navigation:t,layout:{content:b.observable()}}),c.routed.add(function(a,b){d.setHash(a)}),c.bypassed.add(function(a){q()[0]?q()[0].navigate():(v={url:a},w(v))}),d.initialized.add(k),d.changed.add(k),a.onApplicationEvent(function(a){"started"===a&&setTimeout(function(){d.init(),t.init()})}),t});