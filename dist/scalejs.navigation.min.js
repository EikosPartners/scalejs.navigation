define("scalejs.navigation",["scalejs.core","knockout","crossroads","hasher","lodash","module"],function(a,b,c,d,e,f){"use strict";function g(a){for(var b={},c=a.substr(1).split("&"),d=0;d<c.length;d+=1){var e=c[d].split("=");b[decodeURIComponent(e[0])]=decodeURIComponent(e[1]||"");try{b[decodeURIComponent(e[0])]=JSON.parse(b[decodeURIComponent(e[0])])}catch(f){}}return Object.keys(b).forEach(function(a){"true"===b[a]?b[a]=!0:"false"===b[a]?b[a]=!1:"string"==typeof b[a]&&-1!==b[a].indexOf(",")&&(b[a]=b[a].split(","))}),b}function h(a,b){var d,e,f,h,i,j=a.text,k=[];return a.route?(d=a.route,e=d.split("/")[0],f=function(){c.parse(e)},i=function(a){if("string"==typeof a){var c=a.split("?");a=c.length>1?{route:e,path:c[0],query:g("?"+c[1])}:{route:e,path:c[0]||""}}else a=a?{route:e,path:"",query:a}:{route:e,path:""};"/"===a.path[a.path.length-1]&&(a.path=a.path.slice(0,a.path.length-1)),a.url=a.route+(a.path?"/"+a.path:"")+(a.query?"/?"+m(a.query):""),A=a,B(A),x&&(b(a),t(h))},k.push(c.addRoute(d,i)),d!==e&&k.push(c.addRoute(e,i))):f=b,h=r(a,{navText:j,navigate:function(){t(h),f()},routes:k,canNav:a.canNav||function(){return!0}}),s.push(h),v[j]=h,h}function i(a){v[a]&&(s.remove(v[a]),v[a].routes.forEach(function(a){c.removeRoute(a)}),delete v[a])}function j(a){t()!==v[a]&&t(v[a])}function k(){0===s().length||t()||s()[0].navigate()}function l(a,b){c.parse(a)}function m(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent("string"==typeof a[c]?a[c]:JSON.stringify(a[c])));return b.join("&")}function n(a,b,c,d){var e=A.route+(A.path?"/"+A.path:"");return e===a&&JSON.stringify(A.query||{})===JSON.stringify(b)?void console.warn("Trying to set the same route; will be disregarded"):(c===!1&&(x=!1),b&&(a+="/?"+m(b)),d===!1?q(a,!0):q(a),void(x=!0))}function o(){var a=A.url;c.resetState(),c.parse(a)}function p(){return e.cloneDeep(B())}function q(a,b){z?(b?d.replaceHash:d.setHash)(a):l(a)}var r=a.object.merge,s=b.observableArray(),t=b.observable(),u=a.object.has,v={},w=w,x=!0,y=f.config()||{},z=u(y.allowSetHash)?y.allowSetHash:!0,A={},B=b.observable(A);return w={navLinks:s,activeLink:t,navigate:j,addNav:h,removeNav:i,init:k,setRoute:n,getCurrent:p,reRoute:o,serialize:m,allowSetHash:z},a.registerExtension({navigation:w,layout:{content:b.observable()}}),c.routed.add(function(a,b){q(a)}),c.bypassed.add(function(a){s()[0]?s()[0].navigate():(A={url:a},B(A))}),d.initialized.add(l),d.changed.add(l),a.onApplicationEvent(function(a){"started"===a&&setTimeout(function(){d.init(),w.init()})}),w});