define("scalejs.navigation",["scalejs!core","knockout","crossroads","hasher"],function(a,b,c,d){"use strict";function e(a){for(var b={},c=a.substr(1).split("&"),d=0;d<c.length;d++){var e=c[d].split("=");b[decodeURIComponent(e[0])]=decodeURIComponent(e[1]||"")}return Object.keys(b).forEach(function(a){"true"===b[a]&&(b[a]=!0),"false"===b[a]&&(b[a]=!1)}),b}function f(a,b,d,f){var g,h,i,j,k;return"function"==typeof b?i=b:(g=b,j=g.split("/")[0],i=function(){c.parse(j)},k=function(a){if(q){if("string"==typeof a){var b=a.split("?");a=b.length>1?{path:b[0],query:e("?"+b[1])}:{path:b[0]||""}}else a=a?{path:"",query:a}:{path:""};a.path.indexOf("/")===a.path.length-1&&(a.path=a.path.slice(0,a.path.length-1)),d(a),n(h)}},c.addRoute(g,k),g!==j&&c.addRoute(j,k)),h={navText:a,navigate:function(){n(h),i()},sub:n.subscribe(function(a){}),canNav:f||function(){return!0}},m.push(h),o[a]=h,h}function g(a){o[a].sub.dispose(),m.remove(o[a]),delete o[a]}function h(a){n()!==o[a]&&n(o[a])}function i(){0===m().length||n()||m()[0].navigate()}function j(a,b){c.parse(a)}function k(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function l(a,b,c){c===!1&&(q=!1),b&&(a+="/?"+k(b)),d.setHash(a),q=!0}var m=b.observableArray(),n=b.observable(),o={},p=p,q=!0;return p={navLinks:m,activeLink:n,navigate:h,addNav:f,removeNav:g,init:i,setRoute:l},a.registerExtension({navigation:p,layout:{content:b.observable()}}),c.routed.add(function(a,b){d.setHash(a)}),c.routed.add(function(){window.scrollTo(0,0)}),d.initialized.add(j),d.changed.add(j),a.onApplicationEvent(function(a){"started"===a&&setTimeout(function(){d.init(),p.init()})}),p});